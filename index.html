<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VNCSM6YVD4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-VNCSM6YVD4');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="n64js.css">

  <title>Downhill Games</title>

  <!-- Gooey-green + Chrome theme -->
  <style>
    :root{
      --goo:#39ff14;--goo-2:#84ff00;--ink:#0b0b0c;--ink-2:#141517;
      --chrome-0:#f7fafc;--chrome-1:#e6eaee;--chrome-2:#cfd6dc;
      --chrome-3:#aeb6bf;--chrome-4:#89929b;--line:rgba(255,255,255,.12);
      --soft:rgba(57,255,20,.18);
    }
    body{
      background:radial-gradient(1200px 600px at 20% -10%,#0e1712 0%,#0a0b0d 40%,#050607 100%);
    }
    .brand-bar{
      background:linear-gradient(180deg,var(--ink),var(--ink-2));
      border-bottom:1px solid var(--line);
      box-shadow:inset 0 -1px 0 rgba(255,255,255,.04),0 8px 24px rgba(0,0,0,.45);
    }
    .brand-logo{height:64px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.6));}
    .brand-bar h1,.brand-bar .text-secondary{color:#e8f2ec;}
    a{color:var(--goo);} a:hover{color:#b9ff8a;}
    .chrome-border{
      border:1px solid rgba(255,255,255,.22);border-radius:14px;
      background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,0)) padding-box,
                 linear-gradient(180deg,var(--chrome-0),var(--chrome-2) 40%,var(--chrome-4)) border-box;
      box-shadow:0 1px 0 rgba(255,255,255,.25) inset,0 0 0 1px rgba(0,0,0,.4),0 12px 28px rgba(0,0,0,.45);
      backdrop-filter:blur(4px);
    }
    .card.card-chrome{
      background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.18);border-radius:14px;
      box-shadow:0 10px 26px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.08);
    }
    .card.card-chrome .card-header{
      border-bottom:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,0));
      color:#e6ffe0;
    }
    #display{
      border-radius:12px;border:1px solid rgba(57,255,20,.45);
      box-shadow:0 0 12px var(--soft),0 0 36px rgba(57,255,20,.14),
                 inset 0 0 18px rgba(57,255,20,.08);
      background-color:#000;
    }
    .btn-chrome{
      --sh:rgba(0,0,0,.45);color:#0f1411;
      background:linear-gradient(180deg,var(--chrome-0),var(--chrome-2) 55%,var(--chrome-3));
      border:1px solid rgba(0,0,0,.45);
      box-shadow:0 1px 0 rgba(255,255,255,.6) inset,0 8px 18px var(--sh);
    }
    .btn-chrome:hover{
      background:linear-gradient(180deg,#ffffff,var(--chrome-1) 55%,var(--chrome-2));
    }
    .btn-chrome:active{
      box-shadow:inset 0 2px 8px rgba(0,0,0,.35),0 4px 12px rgba(0,0,0,.35);
      transform:translateY(1px);
    }
    .btn-goo{
      color:#102013;
      background:radial-gradient(120% 140% at 20% 0%,#b9ff8a 0%,var(--goo) 40%,#1df000 70%);
      border:1px solid rgba(57,255,20,.7);
      box-shadow:0 0 10px var(--soft),0 8px 22px rgba(57,255,20,.22),
                 inset 0 1px 0 rgba(255,255,255,.35);
    }
    .btn-goo:hover{
      filter:saturate(1.1) brightness(1.05);
      box-shadow:0 0 14px var(--soft),0 12px 28px rgba(57,255,20,.28),
                 inset 0 1px 0 rgba(255,255,255,.5);
    }
    .btn-goo:active{
      transform:translateY(1px);
      box-shadow:0 0 10px var(--soft),inset 0 3px 12px rgba(0,0,0,.25);
    }
    .toolbar .btn{border-radius:10px;}
    .toolbar .btn-group+.btn-group{margin-left:.5rem;}
    .sidebar .list-group-item{
      background:rgba(0,0,0,.2);color:#d7ffcf;border-color:rgba(255,255,255,.08);
    }
    .sidebar .list-group-item:hover{
      background:rgba(57,255,20,.08);color:#ffffff;border-color:rgba(57,255,20,.25);
    }
    .neon-title{
      color:#eaffea;
      text-shadow:0 0 12px rgba(57,255,20,.35),0 0 40px rgba(57,255,20,.15);
    }
    .divider{
      height:1px;background:linear-gradient(90deg,transparent,rgba(57,255,20,.45),transparent);
      margin:.5rem 0 1rem 0;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <!-- HEADER -->
    <header class="brand-bar rounded-bottom-3 p-3 mb-3">
      <div class="d-flex align-items-center gap-3">
        <img class="brand-logo" src="assets/logo.png" alt="Downhill Games logo" onerror="this.style.display='none'">
        <div class="flex-grow-1">
          <h1 class="h3 mb-1 neon-title">Downhill Games</h1>
          <div class="text-secondary">Gutterdome 64 • dev builds • emulator preview</div>
        </div>
        <div class="d-none d-md-flex align-items-center gap-2">
          <a class="btn btn-outline-light btn-sm" href="#"><i class="bi bi-youtube"></i></a>
          <a class="btn btn-outline-light btn-sm" href="#"><i class="bi bi-twitter-x"></i></a>
          <a class="btn btn-outline-light btn-sm" href="#"><i class="bi bi-discord"></i></a>
          <a class="btn btn-outline-light btn-sm" href="#"><i class="bi bi-joystick"></i></a>
        </div>
      </div>
    </header>

    <div class="row g-4">
      <!-- SIDEBAR -->
      <aside class="col-12 col-lg-3">
        <div class="sidebar">
          <div class="card card-chrome mb-3">
            <div class="card-header"><i class="bi bi-journal-text me-1"></i> Dev Logs</div>
            <div class="list-group list-group-flush">
              <a class="list-group-item list-group-item-action" href="#">#12 Split-screen convergence fixes</a>
              <a class="list-group-item list-group-item-action" href="#">#11 Background render bug squash</a>
              <a class="list-group-item list-group-item-action" href="#">#10 Menu polish pass</a>
              <a class="list-group-item list-group-item-action" href="#">Archive…</a>
            </div>
          </div>
          <div class="card card-chrome mb-3">
            <div class="card-header"><i class="bi bi-film me-1"></i> Trailer</div>
            <div class="card-body">
              <div class="ratio ratio-16x9">
                <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ"
                        title="Gutterdome 64 Trailer"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
              </div>
            </div>
          </div>
          <div class="card card-chrome">
            <div class="card-header"><i class="bi bi-share me-1"></i> Follow</div>
            <div class="card-body d-grid gap-2">
              <a class="btn btn-outline-primary" href="#"><i class="bi bi-youtube me-2"></i>YouTube</a>
              <a class="btn btn-outline-primary" href="#"><i class="bi bi-twitter-x me-2"></i>Twitter / X</a>
              <a class="btn btn-outline-primary" href="#"><i class="bi bi-discord me-2"></i>Discord</a>
              <a class="btn btn-outline-primary" href="#"><i class="bi bi-joystick me-2"></i>Itch.io</a>
              <a class="btn btn-outline-primary" href="#"><i class="bi bi-instagram me-2"></i>Instagram</a>
            </div>
          </div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="col-12 col-lg-9">
        <div class="row">
          <div class="col-sm-12">
            <h2 id="title" class="h4 neon-title">n64js</h2>
            <p>Downhill Games <a href="#" onclick="$('#info').toggle()">Info</a></p>
          </div>
        </div>

        <!-- TOOLBAR -->
        <div class="row toolbar mb-3">
          <div class="col-sm-12">
            <div class="btn-toolbar flex-wrap gap-2">
              <div class="btn-group">
                <button type="button" class="btn btn-chrome" onclick="n64js.ui().triggerLoad()">
                  <i class="bi bi-file-earmark-binary"></i> Load
                </button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-goo" onclick="n64js.toggleRun()" id="runbutton">
                  <i class="bi bi-play"></i> Run
                </button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-chrome" onclick="n64js.ui().toggleControllerConfig()">
                  <i class="bi bi-controller"></i> Controller
                </button>
                <button type="button" class="btn btn-chrome" onclick="n64js.toggleFullscreen()">
                  <i class="bi bi-fullscreen"></i> Fullscreen
                </button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-chrome" onclick="n64js.debugger().toggle()">
                  <i class="bi bi-bug"></i> Debug
                </button>
                <button type="button" class="btn btn-chrome" onclick="n64js.togglePerformance()">
                  <i class="bi bi-graph-up"></i> Perf
                </button>
              </div>
              <div class="btn-group ms-auto">
                <div class="dropdown">
                  <button class="btn btn-chrome dropdown-toggle" id="bd-theme" type="button" data-bs-toggle="dropdown" data-bs-display="static">
                    <span class="theme-icon-active"><i class="bi bi-brightness-high"></i></span>
                    <span id="bd-theme-text">Theme</span>
                  </button>
                  <ul class="dropdown-menu">
                    <li class="px-2 py-1">
                      <button class="dropdown-item" type="button" data-bs-theme-value="light"><i class="bi bi-brightness-high"></i> Light</button>
                      <button class="dropdown-item" type="button" data-bs-theme-value="dark"><i class="bi bi-moon-stars"></i> Dark</button>
                      <button class="dropdown-item" type="button" data-bs-theme-value="auto"><i class="bi bi-circle-half"></i> Auto</button>
                    </li>
                  </ul>
                </div>
              </div>
              <input style="visibility:hidden;display:inline-block;" id="fileInput" name="fileInput" type="file" onchange="n64js.ui().loadFile()" />
            </div>
          </div>
        </div>

        <!-- ALERTS -->
        <div class="row"><div class="col-sm-12" id="alerts"></div></div>

        <!-- CANVAS -->
        <div class="chrome-border p-2 mb-3">
          <canvas id="display" width="640" height="480" class="w-100 rounded" style="background-color:#000;"></canvas>
          <div id="adjacent-debug" class="debug debug-adjacent hidden"></div>
        </div>
        <div id="performance" class="mb-3"></div>

        <!-- INFO (unchanged) -->
        <div class="row"><div class="col-sm-12" id="info" style="display:none">
          <h2>Status</h2>
          <p>Many games run at close to full speed…</p>
          <!-- rest unchanged -->
        </div></div>

        <!-- OUTPUT -->
        <div class="row mt-3"><div class="col-sm-12" id="output">
          <button type="button" class="btn btn-outline-danger btn-sm" id="clear"><i class="bi bi-trash"></i> Clear</button>
          <div class="output fixed"></div>
        </div></div>

        <div class="row mt-4"><div class="col-sm-12">
          <p class="text-body-secondary">By <a href="https://twitter.com/#!/hulkholden">@HulkHolden</a> • <a href="https://github.com/hulkholden/n64js">Code</a></p>
        </div></div>
      </main>
    </div>
  </div>

  <!-- Modal unchanged -->
  <div class="modal" tabindex="-1" id="controller"><div class="modal-dialog"><div class="modal-content"><div class="modal-header">
    <h5 class="modal-title">Controls</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div><div class="modal-body"><p>Controller map here…</p></div></div></div></div>

  <!-- JS imports -->
  <script type="importmap">{ "imports": { "lil-gui": "https://cdn.jsdelivr.net/npm/lil-gui@0.18.2/+esm" } }</script>
  <script src="js/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
          crossorigin="anonymous"></script>
  <script src="js/bootstrap-color-mode-toggler.js"></script>
  <script src="js/md5.js"></script>
  <script src="js/stats.js"></script>
  <script src="js/webgl-debug.js"></script>
  <script type="module" src="build/n64.min.js"></script>

  <!-- shaders unchanged -->
  <script id="fill-shader-vs" type="x-shader/x-vertex">#version 300 es
    in vec4 aPosition;void main(void){gl_Position=aPosition;}
  </script>
  <script id="fill-shader-fs" type="x-shader/x-fragment">#version 300 es
    precision mediump float;uniform vec4 uFillColor;out vec4 outCol;void main(void){outCol=uFillColor;}
  </script>
  <script id="blit-shader-vs
